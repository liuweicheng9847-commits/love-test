<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>äº²å¯†å…³ç³»æ·±åº¦æ‰«æ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* åŸºç¡€æ ·å¼é‡ç½® */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: #fdfbfb;
            margin: 0; padding: 0;
            color: #333;
            min-height: 100vh;
        }

        .container {
            max-width: 450px;
            margin: 0 auto;
            background: #fff;
            min-height: 100vh;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0,0,0,0.05);
        }

        .hidden { display: none !important; }

        /* æŒ‰é’®æ ·å¼ */
        .btn {
            display: block; width: 100%; padding: 15px;
            background: #ff4757; color: white; border: none;
            border-radius: 25px; font-size: 16px; font-weight: bold;
            margin-top: 20px; cursor: pointer;
        }
        .btn:active { opacity: 0.8; }

        /* é¦–é¡µ */
        #landing-page { text-align: center; padding-top: 40px; }
        .logo { font-size: 60px; margin-bottom: 10px; }
        h1 { font-size: 24px; margin: 10px 0; color: #333; }
        .input-box {
            width: 100%; padding: 12px; border: 1px solid #ddd;
            border-radius: 8px; font-size: 16px; margin-top: 10px;
            background: #f9f9f9; outline: none;
        }

        /* ç­”é¢˜é¡µ */
        #quiz-page { padding-top: 10px; }
        .progress-bar { height: 4px; background: #eee; border-radius: 2px; margin-bottom: 20px; }
        .progress-fill { height: 100%; background: #ff4757; width: 0%; transition: width 0.3s; }
        .q-tag { 
            display: inline-block; background: #fff0f0; color: #ff4757; 
            padding: 4px 10px; border-radius: 4px; font-size: 12px; margin-bottom: 10px;
        }
        .q-text { font-size: 18px; font-weight: bold; line-height: 1.5; margin-bottom: 20px; }
        .option-card {
            background: #fff; border: 1px solid #eee; padding: 15px; border-radius: 10px;
            margin-bottom: 12px; cursor: pointer; display: flex; align-items: center;
        }
        .option-card:active { background: #fff5f6; border-color: #ff4757; }
        .option-circle { 
            width: 18px; height: 18px; border: 2px solid #ccc; border-radius: 50%; margin-right: 12px; 
        }

        /* ç»“æœé¡µ */
        .score-card {
            background: linear-gradient(135deg, #ff6b81, #ff4757);
            color: white; border-radius: 15px; padding: 25px; text-align: center;
            margin-bottom: 30px;
        }
        .big-score { font-size: 60px; font-weight: bold; margin: 5px 0; }
        
        .section-title { 
            font-size: 18px; font-weight: bold; margin-bottom: 15px; 
            border-left: 4px solid #ff4757; padding-left: 10px; 
        }

        .card {
            background: #fff; border: 1px solid #eee; border-radius: 12px; 
            padding: 15px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.03);
        }
        .card-title { font-size: 16px; font-weight: bold; margin-bottom: 10px; display: flex; align-items: center; }
        
        /* ä¿®å¤åçš„å†…å®¹æ ·å¼ */
        .diag-text { font-size: 14px; line-height: 1.6; color: #555; margin-bottom: 10px; }
        
        .cp-box { 
            margin-top: 10px; padding-top: 10px; border-top: 1px dashed #eee; 
            font-size: 13px; color: #666;
        }
        .cp-row { margin-bottom: 5px; }
        .cp-label { color: #ff4757; font-weight: bold; margin-right: 5px; }

        .term-box {
            background: #f8f8f8; padding: 10px; border-radius: 6px; 
            font-size: 12px; color: #666; margin-top: 10px;
        }

        /* å¤„æ–¹ç¬º */
        .prescription {
            background: #fff9fa; border: 1px dashed #ffb8b8; border-radius: 12px; padding: 15px;
        }
        .action-item { margin-bottom: 15px; }
        .action-tag { 
            display: inline-block; background: #ff4757; color: white; 
            font-size: 12px; padding: 2px 6px; border-radius: 4px; margin-bottom: 5px;
        }
        .action-desc { font-size: 14px; color: #333; line-height: 1.5; }

        /* ç¤¾äº¤å¡ç‰‡ */
        .social-card {
            background: #333; color: white; padding: 20px; border-radius: 12px; 
            text-align: center; margin-top: 30px;
        }
        .social-tags span { 
            display: inline-block; background: rgba(255,255,255,0.2); 
            padding: 4px 8px; border-radius: 4px; font-size: 12px; margin: 0 5px;
        }
        .hint-btn {
            background: transparent; border: 1px solid rgba(255,255,255,0.3); color: #ccc;
            padding: 8px 15px; border-radius: 20px; font-size: 12px; margin-top: 15px;
        }

        /* åŠ è½½ */
        #loading-page { text-align: center; padding-top: 100px; }
    </style>
</head>
<body>

<div class="container">
    <div id="landing-page">
        <div class="logo">ğŸ©</div>
        <h1>äº²å¯†å…³ç³»æ·±åº¦æ‰«æ</h1>
        <p style="color:#666; font-size:14px;">å¬è§èº«ä½“æ²¡è¯´å‡ºå£çš„è¯ Â· çµé­‚ç‰ˆ</p>
        
        <div style="text-align:left; margin-top:30px;">
            <p style="font-weight:bold;">è¯·è¾“å…¥è§£é”ç ï¼š</p>
            <input type="text" id="access-code" class="input-box" placeholder="è´­ä¹°åè‡ªåŠ¨å‘è´§..." autocomplete="off">
            <button class="btn" onclick="startTest()">å¼€å§‹æ‰«æ</button>
            <p style="font-size:12px; color:#999; margin-top:15px; text-align:center;">* 16é“æƒ…å¢ƒå¼æµ‹è¯„ï¼Œé¢„è®¡è€—æ—¶3åˆ†é’Ÿ</p>
        </div>
    </div>

    <div id="quiz-page" class="hidden">
        <div class="progress-bar"><div class="progress-fill" id="progress"></div></div>
        <div style="text-align:right; font-size:12px; color:#999; margin-bottom:5px;">
            <span id="q-curr">1</span> / <span id="q-total">16</span>
        </div>
        <div class="q-tag" id="q-tag">åˆ†ç±»</div>
        <div class="q-text" id="q-title">é¢˜ç›®åŠ è½½ä¸­...</div>
        <div id="options-container"></div>
    </div>

    <div id="loading-page" class="hidden">
        <h3>AI æƒ…æ„Ÿä¸“å®¶æ­£åœ¨ä¼šè¯Š...</h3>
        <p id="loading-text" style="color:#666; font-size:14px; margin-top:10px;">æ­£åœ¨è§£è¯»æ½œæ„è¯†ä¿¡å·...</p>
    </div>

    <div id="result-page" class="hidden">
        <div class="score-card" id="score-card-bg">
            <div style="opacity:0.9; font-size:14px;">äº²å¯†å…³ç³»èƒ½é‡æŒ‡æ•°</div>
            <div class="big-score" id="final-score">--</div>
            <div id="score-comment" style="background:rgba(0,0,0,0.2); display:inline-block; padding:4px 12px; border-radius:15px; font-size:13px;">æ­£åœ¨ç”Ÿæˆ...</div>
        </div>

        <div class="section-title">èƒ½é‡åˆ†å¸ƒå›¾è°±</div>
        <div style="position:relative; height:200px; margin-bottom:30px;">
            <canvas id="radarChart"></canvas>
        </div>

        <div class="section-title">ä½ çš„çµé­‚åº•è‰²</div>
        
        <div class="card">
            <div class="card-title">ğŸ¦‹ æ€§çˆ±äººæ ¼ (Erotic Persona)</div>
            <div id="type-content"></div>
        </div>

        <div class="card">
            <div class="card-title">ğŸ”’ å†…å¿ƒå®‰å…¨é” (Inner Security Lock)</div>
            <div id="brake-content"></div>
        </div>

        <div class="section-title">ç»™å…³ç³»çš„çµè¯</div>
        <div class="prescription">
            <div id="healing-intro" style="font-style:italic; color:#666; font-size:14px; margin-bottom:15px; border-bottom:1px solid #eee; padding-bottom:10px;"></div>
            <div id="action-plan"></div>
        </div>

        <div class="social-card">
            <div style="font-size:12px; opacity:0.7; margin-bottom:10px;">MY INTIMACY REPORT</div>
            <div id="social-quote" style="font-size:16px; font-weight:bold; margin-bottom:15px;">"æ‰€è°“äº²å¯†ï¼Œä¸è¿‡æ˜¯èº«ä½“ç»ˆäºæ‰¾åˆ°äº†å®ƒçš„æ¯è¯­ã€‚"</div>
            <div class="social-tags" id="social-tags">
                <span>#çµé­‚åº•è‰²</span> <span>#äº²å¯†å…³ç³»</span>
            </div>
            <button class="hint-btn">ğŸ‘‰ é•¿æŒ‰ä¿å­˜ / æˆªå›¾åˆ†äº«</button>
        </div>
    </div>
</div>

<script>
    // é…ç½®
    var VALID_CODES = ["888888", "Love2024", "A1B2C3", "Test001"];

    // é¢˜åº“
    var questions = [
        // ç°çŠ¶
        { category: "èƒ½é‡åœºÂ·é¢‘ç‡", title: "é™¤å»ç”Ÿç†æœŸï¼Œæœ€è¿‘ä¸¤ä¸ªæœˆï¼Œä½ ä»¬æ·±å±‚äº²å¯†æ¥è§¦ï¼ˆDoï¼‰çš„çœŸå®çŠ¶æ€æ˜¯ï¼Ÿ", options: [{ text: "å¹²æŸ´çƒˆç«ï¼šæ¯å‘¨2æ¬¡ä»¥ä¸Šï¼Œå……æ»¡æ¿€æƒ…", score: 100, dimension: "frequency" }, { text: "ç»†æ°´é•¿æµï¼šæ¯å‘¨1æ¬¡å·¦å³ï¼Œè§„å¾‹ä¸”ç¨³å®š", score: 80, dimension: "frequency" }, { text: "ä¾‹è¡Œå…¬äº‹ï¼šåŠä¸ªæœˆ1æ¬¡ï¼Œåƒå®Œæˆä»»åŠ¡", score: 50, dimension: "frequency" }, { text: "å®¤å‹æ¨¡å¼ï¼šä¸€ä¸ªæœˆä»¥ä¸Šæ²¡æœ‰äº†ï¼Œå¿ƒå¦‚æ­¢æ°´", score: 20, dimension: "frequency" }] },
        { category: "èƒ½é‡åœºÂ·è·ç¦»", title: "æ™šä¸Šå…³ç¯ç¡è§‰æ—¶ï¼Œä½ ä»¬é€šå¸¸çš„èº«ä½“è·ç¦»æ˜¯ï¼Ÿ", options: [{ text: "è¿ä½“å©´ï¼šå¿…é¡»ç´§ç´§æŠ±ç€æ‰èƒ½ç¡ç€", score: 100, dimension: "passion" }, { text: "æ­ä¼™äººï¼šä¼šæœ‰è‚¢ä½“æ­åœ¨å¯¹æ–¹èº«ä¸Š", score: 80, dimension: "passion" }, { text: "æ¥šæ²³æ±‰ç•Œï¼šå„ç¡å„çš„ï¼Œå°½é‡äº’ä¸å¹²æ‰°", score: 40, dimension: "passion" }, { text: "èƒŒå¯¹èƒŒï¼šèƒŒå¯¹ç€ç¡ï¼Œå¾ˆä¹…éƒ½ä¸æ•¢ç¿»èº«", score: 20, dimension: "passion" }] },
        { category: "èƒ½é‡åœºÂ·å¿ƒåŠ¨", title: "å¦‚æœä¸å‘ç”Ÿå…³ç³»ï¼Œä½ ä»¬ç°åœ¨è¿˜ä¼šæ·±æƒ…æ¥å»ï¼ˆèˆŒå»ï¼‰å—ï¼Ÿ", options: [{ text: "ä¼šï¼Œå‡ºé—¨å‰æˆ–ç¡å‰éƒ½ä¼šè‡ªç„¶çš„æ·±å»", score: 100, dimension: "passion" }, { text: "åªæœ‰åœ¨â€œåŠäº‹â€çš„å‰æˆé‡Œæ‰ä¼šï¼Œåƒä¸ªç¨‹åº", score: 60, dimension: "passion" }, { text: "å¾ˆä¹…æ²¡æœ‰äº†ï¼Œç°åœ¨çš„äº²äº²åªæ˜¯ç¢°ä¸€ä¸‹å˜´çš®å­", score: 20, dimension: "passion" }] },
        { category: "èƒ½é‡åœºÂ·ä¸»åŠ¨", title: "é€šå¸¸æ˜¯è°å…ˆå‘èµ·ä¿¡å·ï¼Ÿ", options: [{ text: "é»˜å¥‘ï¼šçœ¼ç¥å¯¹ä¸Šå°±æ‡‚äº†", score: 90, dimension: "frequency" }, { text: "è¢«åŠ¨ï¼šåŸºæœ¬éƒ½æ˜¯å¯¹æ–¹ï¼Œæˆ‘é…åˆ", score: 60, dimension: "frequency" }, { text: "å¿ƒç´¯ï¼šåŸºæœ¬éƒ½æ˜¯æˆ‘ï¼Œç»å¸¸è§‰å¾—è‡ªå·±åƒä¸ªä¹ä¸", score: 30, dimension: "frequency" }, { text: "è£…å‚»ï¼šæ²¡äººå‘èµ·ï¼Œéƒ½åœ¨å‡è£…ç©æ‰‹æœº", score: 10, dimension: "frequency" }] },
        // äººæ ¼
        { category: "çµé­‚Â·åå¥½", title: "ç›¸æ¯”äºç›´å¥”ä¸»é¢˜ï¼Œä½ æ˜¯å¦éœ€è¦é•¿æ—¶é—´çš„æŒ‰æ‘©ã€æ‹¥æŠ±å’Œç¯å¢ƒæ°›å›´é“ºå«ï¼Ÿ", options: [{ text: "æ˜¯çš„ï¼Œæ²¡æœ‰é“ºå«æˆ‘å®Œå…¨æ²¡æ„Ÿè§‰ï¼Œç”šè‡³åæ„Ÿ", type: "Sensual", score: 80, dimension: "skill" }, { text: "çœ‹æƒ…å†µï¼Œæœ‰æ—¶å€™ä¹Ÿå–œæ¬¢å¿«èŠ‚å¥çš„åˆºæ¿€", type: "Normal", score: 60, dimension: "skill" }, { text: "ä¸éœ€è¦ï¼Œå¼ºçƒˆçš„è§†è§‰/åŠ¨ä½œåˆºæ¿€æ›´é‡è¦", type: "Visual", score: 60, dimension: "skill" }] },
        { category: "çµé­‚Â·å¼€å…³", title: "å½“çœ‹åˆ°ä¼´ä¾£ç©¿ç€ç‰¹å®šçš„æ€§æ„Ÿè£…æ‰®ï¼Œæˆ–åœ¨æ˜äº®ç¯å…‰ä¸‹ï¼Œä½ çš„ååº”æ˜¯ï¼Ÿ", options: [{ text: "ç¬é—´ç‚¹ç‡ƒï¼šè§†è§‰å†²å‡»å¯¹æˆ‘æ˜¯ç¬¬ä¸€æ‰“ç«æœº", type: "Visual", score: 80, dimension: "passion" }, { text: "ä¸€èˆ¬èˆ¬ï¼šæˆ‘æ›´çœ‹é‡æ°”å‘³ã€å£°éŸ³å’Œè§¦æ„Ÿ", type: "Sensual", score: 60, dimension: "passion" }, { text: "æ— æ„Ÿï¼šæˆ‘æ›´åœ¨ä¹å½“ä¸‹çš„æƒ…æ„Ÿé“¾æ¥", type: "Normal", score: 60, dimension: "passion" }] },
        { category: "çµé­‚Â·æ¢ç´¢", title: "å¯¹äºå°è¯•æ–°èŠ±æ ·ï¼ˆå¦‚ç©å…·ã€è§’è‰²æ‰®æ¼”ã€æ–°åœ°ç‚¹ï¼‰ï¼Œä½ çš„æ€åº¦æ˜¯ï¼Ÿ", options: [{ text: "éå¸¸æœŸå¾…ï¼Œæ—©å°±æƒ³è¯•äº†", score: 100, dimension: "skill" }, { text: "æœ‰ç‚¹å®³ç¾ï¼Œä½†å¯¹æ–¹å¼•å¯¼çš„è¯æ„¿æ„è¯•", score: 80, dimension: "skill" }, { text: "æ’æ–¥ï¼Œè§‰å¾—é‚£æ ·å¾ˆå¥‡æ€ª", score: 20, dimension: "skill" }] },
        { category: "çµé­‚Â·é“¾æ¥", title: "å¦‚æœä»Šå¤©å‘ç”Ÿè¿‡æ·±åº¦çš„çµé­‚æ²Ÿé€šï¼ˆèŠå¾—å¾ˆå¼€å¿ƒï¼‰ï¼Œæ™šä¸Šä½ ä¼šæ›´å®¹æ˜“æƒ³è¦å—ï¼Ÿ", options: [{ text: "ä¼šï¼å¿ƒè¿‘äº†èº«ä½“æ‰æƒ³è¿‘", type: "Sensual", score: 100, dimension: "skill" }, { text: "æ²¡å¤ªå¤§å…³ç³»ï¼Œèº«ä½“å½’èº«ä½“", type: "Visual", score: 60, dimension: "skill" }] },
        // åˆ¹è½¦
        { category: "é˜»æ–­Â·ç¯å¢ƒ", title: "å¦‚æœåœ¨è¿‡ç¨‹ä¸­çªç„¶å¬åˆ°é—¨å¤–æœ‰å¼‚å“ï¼ˆå¦‚å®¶äºº/å®¤å‹ï¼‰ï¼Œä½ ä¼šï¼Ÿ", options: [{ text: "ç¬é—´æ²¡å…´è‡´ï¼Œå¿…é¡»åœä¸‹ç¡®è®¤å®‰å…¨", score: 40, dimension: "safe", brake: "High" }, { text: "æœ‰ç‚¹ç´§å¼ ï¼Œä½†ç¡®è®¤æ²¡äº‹èƒ½ç»§ç»­", score: 70, dimension: "safe", brake: "Medium" }, { text: "å®Œå…¨ä¸å½±å“ï¼Œç”šè‡³è§‰å¾—æ›´åˆºæ¿€", score: 100, dimension: "safe", brake: "Low" }] },
        { category: "é˜»æ–­Â·è‡ªæˆ‘", title: "å½“ä»–çš„æ‰‹è§¦ç¢°åˆ°ä½ çš„è…°æˆ–è‚šå­æ—¶ï¼Œä½ çš„ä¸‹æ„è¯†ååº”æ˜¯ï¼Ÿ", options: [{ text: "ç¬é—´å¸æ°”æ”¶è…¹ï¼Œç”šè‡³æƒ³æŠŠä»–çš„æ‰‹æ‹¿å¼€", score: 40, dimension: "safe", brake: "High" }, { text: "å¾ˆæ”¾æ¾ï¼Œä»»ç”±ä»–è§¦ç¢°", score: 80, dimension: "safe", brake: "Medium" }, { text: "ç‰¹æ„å±•ç¤ºæ›²çº¿ï¼Œè§‰å¾—æˆ‘å¾ˆè¿·äºº", score: 100, dimension: "safe", brake: "Low" }] },
        { category: "é˜»æ–­Â·æƒ…ç»ª", title: "å¦‚æœç™½å¤©åˆšåµäº†ä¸€æ¶ï¼Œæ™šä¸Šå¯¹æ–¹æ¥æ±‚å’Œï¼Œä½ ä¼šï¼Ÿ", options: [{ text: "æ»šï¼Œåˆ«ç¢°æˆ‘ï¼ˆæƒ…ç»ªæœªæ¶ˆæ— æ³•èº«ä½“æ¥è§¦ï¼‰", score: 30, dimension: "safe", brake: "High" }, { text: "å¯ä»¥åšï¼Œåšå®Œä¹Ÿè®¸å°±å¥½äº†ï¼ˆæ€§çˆ±åˆ†ç¦»ï¼‰", score: 90, dimension: "safe", brake: "Low" }] },
        { category: "é˜»æ–­Â·å‹åŠ›", title: "å½“å·¥ä½œå‹åŠ›å·¨å¤§ã€ç‰¹åˆ«ç–²æƒ«çš„æ—¶å€™ï¼Œäº²çƒ­å¯¹ä½ æ¥è¯´æ˜¯ï¼Ÿ", options: [{ text: "æ˜¯è´Ÿæ‹…ï¼Œåªæƒ³ç¡è§‰ï¼Œåˆ«çƒ¦æˆ‘", score: 40, dimension: "safe", brake: "High" }, { text: "æ˜¯è§£å‹æ–¹å¼ï¼Œåšå®Œæ›´è½»æ¾", score: 100, dimension: "safe", brake: "Low" }] },
        // æœªæ¥
        { category: "é¢„åÂ·ç»“å±€", title: "å¦‚æœä¸€æ–¹å‘å‡ºçš„ä¿¡å·è¢«â€œå†·å¤„ç†â€æˆ–æ‹’ç»äº†ï¼Œå½“æ™šå…³ç¯åçš„ç©ºæ°”æ˜¯æ€æ ·çš„ï¼Ÿ", options: [{ text: "åƒæ²¡å‘ç”Ÿè¿‡ä¸€æ ·ï¼Œä¾ç„¶æŠ±åœ¨ä¸€èµ·ç¡", score: 90, dimension: "comm" }, { text: "æœ‰ç‚¹å°´å°¬ï¼ŒèƒŒå¯¹èƒŒæ²‰é»˜", score: 60, dimension: "comm" }, { text: "è¢«æ‹’çš„é‚£æ–¹èƒŒå¯¹ç€ç¡ï¼Œå¾ˆä¹…éƒ½ä¸æ•¢ç¿»èº«", score: 20, dimension: "comm" }] },
        { category: "é¢„åÂ·æ²Ÿé€š", title: "ä½ ä»¬æœ€è¿‘ä¸€æ¬¡è¿›è¡Œæ·±åº¦çš„ã€ä¸çœ‹æ‰‹æœºçš„è°ˆå¿ƒï¼Œæ˜¯ä»€ä¹ˆæ—¶å€™ï¼Ÿ", options: [{ text: "æœ€è¿‘ä¸‰å¤©å†…", score: 100, dimension: "comm" }, { text: "åŠä¸ªæœˆå·¦å³", score: 70, dimension: "comm" }, { text: "ä¸è®°å¾—äº†ï¼Œå¹³æ—¶åªèŠå®¶åŠ¡çäº‹", score: 30, dimension: "comm" }] },
        { category: "é¢„åÂ·å±•æœ›", title: "è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœä½ ä½™ç”Ÿå‡ åå¹´çš„äº²å¯†è´¨é‡éƒ½ç»´æŒç°åœ¨çš„çŠ¶æ€ï¼Œä½ èƒ½æ¥å—å—ï¼Ÿ", options: [{ text: "æ²¡é—®é¢˜ï¼Œç°åœ¨çš„çŠ¶æ€è®©æˆ‘å¾ˆå®‰å¿ƒ", score: 100, dimension: "comm" }, { text: "çŠ¹è±«ï¼Œè§‰å¾—æœ‰ç‚¹åƒç™½å¼€æ°´ï¼Œä½†ä¹Ÿå‡‘åˆ", score: 50, dimension: "comm" }, { text: "ç¬é—´æ„Ÿåˆ°çª’æ¯/ç»æœ›ï¼Œæƒ³é€ƒç¦»", score: 0, dimension: "comm" }] },
        { category: "é¢„åÂ·æ„æ„¿", title: "å¦‚æœå¯¹æ–¹æå‡ºæƒ³å’Œä½ å¥½å¥½èŠèŠâ€œä¸å’Œè°â€çš„é—®é¢˜ï¼Œä½ ä¼šï¼Ÿ", options: [{ text: "éå¸¸æ„¿æ„ï¼Œå¸Œæœ›èƒ½ä¸€èµ·è§£å†³", score: 100, dimension: "comm" }, { text: "æœ‰ç‚¹å°´å°¬ï¼Œä½†ä¼šé…åˆ", score: 70, dimension: "comm" }, { text: "å›é¿ï¼Œè§‰å¾—æ²¡ä»€ä¹ˆå¥½èŠçš„", score: 20, dimension: "comm" }] }
    ];

    // çŠ¶æ€
    var currentStep = 0;
    var scores = { frequency:0, passion:0, skill:0, safe:0, comm:0 };
    var counts = { frequency:0, passion:0, skill:0, safe:0, comm:0 };
    var types = { Sensual:0, Visual:0, Normal:0 };
    var brakes = [];

    document.getElementById('q-total').innerText = questions.length;

    function startTest() {
        var code = document.getElementById('access-code').value.trim();
        if(VALID_CODES.indexOf(code) !== -1) {
            document.getElementById('landing-page').classList.add('hidden');
            document.getElementById('quiz-page').classList.remove('hidden');
            renderQuestion();
        } else {
            alert("è§£é”ç é”™è¯¯ï¼Œè¯·æ£€æŸ¥æ˜¯å¦è¾“å…¥æ­£ç¡®");
        }
    }

    function renderQuestion() {
        if(currentStep >= questions.length) {
            finishTest();
            return;
        }
        var q = questions[currentStep];
        var percent = ((currentStep+1)/questions.length)*100 + "%";
        document.getElementById('progress').style.width = percent;
        document.getElementById('q-curr').innerText = currentStep + 1;
        document.getElementById('q-tag').innerText = q.category;
        document.getElementById('q-title').innerText = q.title;
        
        var html = '';
        for(var i=0; i<q.options.length; i++) {
            var opt = q.options[i];
            html += '<div class="option-card" onclick="selectOpt('+i+')">' +
                    '<div class="option-circle"></div>' +
                    '<div style="font-size:15px;color:#555;">' + opt.text + '</div>' +
                    '</div>';
        }
        document.getElementById('options-container').innerHTML = html;
    }

    function selectOpt(idx) {
        var q = questions[currentStep];
        var opt = q.options[idx];
        if(opt.dimension) { scores[opt.dimension]+=opt.score; counts[opt.dimension]++; }
        if(opt.type) types[opt.type]++;
        if(opt.brake) brakes.push(opt.score);
        currentStep++;
        setTimeout(renderQuestion, 200);
    }

    function finishTest() {
        document.getElementById('quiz-page').classList.add('hidden');
        document.getElementById('loading-page').classList.remove('hidden');
        
        var texts = ["æ­£åœ¨é“¾æ¥æ½œæ„è¯†...", "æ­£åœ¨åˆ†æèƒ½é‡é˜»æ–­...", "æ­£åœ¨ç”Ÿæˆçµé­‚å¤„æ–¹..."];
        var i=0;
        var timer = setInterval(function(){
            document.getElementById('loading-text').innerText = texts[i%texts.length];
            i++;
        }, 1200);

        setTimeout(function() {
            clearInterval(timer);
            showResult();
        }, 3000);
    }

    function showResult() {
        document.getElementById('loading-page').classList.add('hidden');
        document.getElementById('result-page').classList.remove('hidden');

        // è®¡ç®—
        var dimensions = ["frequency","passion","skill","safe","comm"];
        var radarData = [];
        var total = 0;
        
        for(var i=0; i<dimensions.length; i++) {
            var key = dimensions[i];
            var val = counts[key] ? Math.round(scores[key]/counts[key]) : 60;
            radarData.push(val);
            total += val;
        }
        
        var finalScore = Math.round(total/5);
        
        // æ¸²æŸ“åˆ†æ•°
        document.getElementById('final-score').innerText = finalScore;
        var comment = "";
        var bgStyle = "";
        
        if(finalScore > 85) {
            comment = "ç¥ä»™çœ·ä¾£ (çµé­‚å…±æŒ¯)";
            bgStyle = "linear-gradient(135deg, #2ed573, #7bed9f)";
        } else if (finalScore > 70) {
            comment = "äºšå¥åº· (æ³¢åŠ¨æœŸ)";
            bgStyle = "linear-gradient(135deg, #ffa502, #ffc048)";
        } else if (finalScore > 50) {
            comment = "åˆç§Ÿå®¤å‹ (ç¼ºä¹å†²åŠ¨)";
            bgStyle = "linear-gradient(135deg, #ff7f50, #ff6b81)";
        } else {
            comment = "ä¸§å¶å¼å…³ç³» (å¿ƒéš”ç‰‡æµ·)";
            bgStyle = "linear-gradient(135deg, #d63031, #ff7675)";
        }
        document.getElementById('score-comment').innerText = comment;
        document.getElementById('score-card-bg').style.background = bgStyle;

        // é›·è¾¾å›¾
        var ctx = document.getElementById('radarChart').getContext('2d');
        new Chart(ctx, {
            type: 'radar',
            data: {
                labels: ["é¢‘ç‡", "æ¿€æƒ…", "æŠ€å·§", "å®‰å…¨æ„Ÿ", "æ²Ÿé€š"],
                datasets: [{
                    label: 'èƒ½é‡åˆ†å¸ƒ', data: radarData,
                    backgroundColor: 'rgba(255, 71, 87, 0.2)', borderColor: '#ff4757', borderWidth: 2, pointBackgroundColor: '#ff4757'
                }]
            },
            options: { scales: { r: { suggestedMin: 0, suggestedMax: 100, ticks: {display:false} } }, plugins: { legend: {display:false} } }
        });

        // è¯Šæ–­é€»è¾‘
        var maxType = "Normal";
        if(types.Sensual >= types.Visual && types.Sensual >= types.Normal) maxType = "Sensual";
        else if(types.Visual >= types.Sensual && types.Visual >= types.Normal) maxType = "Visual";
        
        var sumBrake = 0;
        for(var j=0; j<brakes.length; j++) sumBrake += brakes[j];
        var avgBrake = brakes.length ? (sumBrake/brakes.length) : 60;
        var brakeLevel = avgBrake <= 60 ? "High" : "Low";

        // äººæ ¼å†…å®¹
        var typeHtml = "";
        var socialTag = "";
        var socialQuote = "";

        if(maxType === "Sensual") {
            socialTag = "#é«˜æ•æ„ŸÂ·çŒ«ç³»";
            socialQuote = "çˆ±å¯¹ä½ æ¥è¯´ï¼Œæ˜¯çš®è‚¤ä¸Šçš„è¯—å¥ã€‚";
            typeHtml = '<div style="font-weight:bold; color:#d35400; margin-bottom:5px;">é«˜æ•æ„ŸÂ·çŒ«ç³» (Sensual)</div>' +
                       '<div class="diag-text">ä½ åƒä¸€åªä¼˜é›…çš„çŒ«ã€‚ä½ éœ€è¦çš„ä¸æ˜¯ç›´å¥”ä¸»é¢˜çš„â€œäº¤ä½œä¸šâ€ï¼Œè€Œæ˜¯æ¼«é•¿çš„ã€å……æ»¡äº†çˆ±æ„çš„é¢„çƒ­ã€‚ä½ ç°åœ¨çš„æŠ—æ‹’ï¼Œå¾ˆå¯èƒ½æ˜¯å› ä¸ºä½ çš„èº«ä½“è§‰å¾—è¢«â€œå†’çŠ¯â€äº†ã€‚</div>' +
                       '<div class="cp-box"><div class="cp-row"><span class="cp-label">â¤ï¸ ç»é…ï¼š</span>èƒ½é‡å‹ (æ‡‚ä½ çš„çµé­‚)</div>' +
                       '<div class="cp-row"><span class="cp-label">âš”ï¸ å¤©æ•Œï¼š</span>æœºæ¢°å‹ (åªèµ°ç¨‹åº)</div></div>' +
                       '<div class="term-box"><b>âœ¨ èƒ½é‡è§£è¯»ï¼š</b>ä½ çš„çš®è‚¤æ˜¯æ¥æ”¶çˆ±çš„å¤©çº¿ã€‚å½“ä½ æ„Ÿåˆ°è¢«çˆ±æ—¶ï¼Œä½ æ¯”è°éƒ½æŸ”è½¯ï¼›å½“ä½ æ„Ÿåˆ°å‹åŠ›æ—¶ï¼Œä½ ä¼šç¬é—´ç‚¸æ¯›å¹¶é€ƒç¦»ã€‚</div>';
        } else if(maxType === "Visual") {
            socialTag = "#è§†è§‰ç³»Â·çŒæ‰‹";
            socialQuote = "çˆ±æ˜¯çœ¼é‡Œçš„ç«ç„°ï¼Œå§‹äºå‡è§†ï¼Œç»ˆäºç‡ƒçƒ§ã€‚";
            typeHtml = '<div style="font-weight:bold; color:#c0392b; margin-bottom:5px;">è§†è§‰ç³»Â·çŒæ‰‹ (Visual)</div>' +
                       '<div class="diag-text">ä½ æ˜¯çƒ­æƒ…çš„ç«ç„°ã€‚ä½ å®¹æ˜“è¢«è§†è§‰ç¬¦å·ï¼ˆèº«æ/çœ¼ç¥/ç¯å…‰ï¼‰ç‚¹ç‡ƒã€‚ç°åœ¨çš„å¹³æ·¡ï¼Œå¾ˆå¤§ç¨‹åº¦æ˜¯å› ä¸ºç”Ÿæ´»ä¸­ç¼ºä¹äº†è¿™äº›è®©ä½ çœ¼å‰ä¸€äº®çš„â€œä¿¡å·â€ã€‚</div>' +
                       '<div class="cp-box"><div class="cp-row"><span class="cp-label">â¤ï¸ ç»é…ï¼š</span>å¤§èƒ†å‹ (æ•¢äºå±•ç¤º)</div>' +
                       '<div class="cp-row"><span class="cp-label">âš”ï¸ å¤©æ•Œï¼š</span>ä¿å®ˆå‹ (æ°¸è¿œå…³ç¯)</div></div>';
        } else {
            socialTag = "#æµåŠ¨å‹Â·çµé­‚";
            socialQuote = "èº«ä½“çš„çº ç¼ ï¼Œæœ¬è´¨æ˜¯èƒ½é‡çš„å…±æŒ¯ã€‚";
            typeHtml = '<div style="font-weight:bold; color:#0984e3; margin-bottom:5px;">æµåŠ¨å‹Â·é€šçµè€… (Energetic)</div>' +
                       '<div class="diag-text">ä½ éå¸¸çœ‹é‡â€œèƒ½é‡æµåŠ¨â€ã€‚å¦‚æœä¸¤ä¸ªäººæƒ…ç»ªä¸åŒé¢‘ï¼Œæˆ–è€…åˆšåµå®Œæ¶ï¼Œä½ çš„èº«ä½“ä¼šæœ¬èƒ½åœ°å…³é—­ã€‚ä½ éœ€è¦çš„æ˜¯å…ˆè¿å¿ƒï¼Œå†è¿èº«ã€‚</div>' +
                       '<div class="cp-box"><div class="cp-row"><span class="cp-label">â¤ï¸ ç»é…ï¼š</span>çµé­‚ä¼´ä¾£ (æƒ…ç»ªåŒé¢‘)</div>' +
                       '<div class="cp-row"><span class="cp-label">âš”ï¸ å¤©æ•Œï¼š</span>å†·æ¼ å‹ (æ‹’ç»æ²Ÿé€š)</div></div>';
        }
        document.getElementById('type-content').innerHTML = typeHtml;
        document.getElementById('social-quote').innerText = socialQuote;
        document.getElementById('social-tags').innerHTML = '<span>'+socialTag+'</span><span>#äº²å¯†å…³ç³»</span>';

        // åˆ¹è½¦å†…å®¹
        var brakeHtml = "";
        if(brakeLevel === "High") {
            brakeHtml = '<div style="font-weight:bold; color:#c0392b; margin-bottom:5px;">é«˜æ•Â·å®‰å…¨é” (Sensitive Lock)</div>' +
                        '<div class="diag-text">ä½ ä¸æ˜¯â€œå†·æ·¡â€ï¼Œä½ æ˜¯â€œé«˜å‹å—å®³è€…â€ã€‚ä½ çš„å†…å¿ƒæœ‰ä¸€æŠŠæçµæ•çš„å®‰å…¨é”ã€‚å‹åŠ›ã€èº«æç„¦è™‘ã€æˆ–ç¯å¢ƒå™ªéŸ³ï¼Œéƒ½ä¼šä¼˜å…ˆè§¦å‘ä½ çš„é˜²å¾¡æœºåˆ¶ã€‚</div>' +
                        '<div class="term-box"><b>ğŸ’¡ æ‡‚ä½ ï¼š</b>è¿™è¯´æ˜ä½ æ˜¯ä¸€ä¸ªå¿ƒæ€ç»†è…»çš„äººã€‚åªæœ‰åœ¨ç»å¯¹æ”¾æ¾ã€è¢«å® çˆ±çš„ç¯å¢ƒé‡Œï¼Œä½ çš„é”æ‰ä¼šæ‰“å¼€ã€‚</div>';
        } else {
            brakeHtml = '<div style="font-weight:bold; color:#27ae60; margin-bottom:5px;">å¹³è¡¡Â·å®‰å…¨é” (Balanced Lock)</div>' +
                        '<div class="diag-text">ä½ çš„ç”Ÿç†æœºåˆ¶å¾ˆå¥åº·ã€‚å¦‚æœä¸æƒ³åšï¼Œæ›´å¤šæ˜¯å› ä¸ºæƒ…æ„Ÿè¿æ¥æˆ–æ²Ÿé€šæ–¹å¼å‡ºç°äº†é”™ä½ï¼Œè€Œéç”Ÿç†å±‚é¢çš„æŠ‘åˆ¶ã€‚</div>';
        }
        document.getElementById('brake-content').innerHTML = brakeHtml;

        // å¤„æ–¹å†…å®¹
        document.getElementById('healing-intro').innerHTML = 'äº²çˆ±çš„ï¼Œçœ‹åˆ°è¿™ä¸ªç»“æœè¯·ä¸è¦ç„¦è™‘ã€‚<b>æ‹’ç»ä¸æ˜¯å› ä¸ºä¸çˆ±ï¼Œè€Œæ˜¯å› ä¸ºèº«ä½“æ²¡æœ‰è¢«â€œæ­£ç¡®åœ°å¬è§â€</b>ã€‚æ—¢ç„¶ä»–ä¸æ‡‚è¿™äº›ï¼Œé‚£å°±ç”±ä½ æ¥å¼•å¯¼ä»–ã€‚';

        var actionHtml = "";
        if(maxType === "Sensual") {
            actionHtml += '<div class="action-item"><span class="action-tag">è„±æ•ç»ƒä¹ </span><div class="action-desc">æœ¬å‘¨çº¦å®šä¸€æ¬¡â€œåªè®¸æŠšæ‘¸ï¼Œä¸è®¸è¶Šç•Œâ€çš„æ—¶é—´ã€‚å‘Šè¯‰ä»–ï¼šâ€œä»Šæ™šæˆ‘åªæƒ³è®©ä½ æŠ±æˆ‘ã€æ‘¸æˆ‘çš„åèƒŒ15åˆ†é’Ÿï¼Œç»å¯¹ä¸å¯ä»¥åšæœ€åä¸€æ­¥ã€‚â€è¿™èƒ½è®©ä½ ç´§ç»·çš„é˜²å¾¡æœºåˆ¶æ”¾æ¾ä¸‹æ¥ã€‚</div></div>';
        } else {
            actionHtml += '<div class="action-item"><span class="action-tag">è§†è§‰å”¤é†’</span><div class="action-desc">åˆ«å…³ç¯ï¼æˆ–è€…ç•™ä¸€ç›æš–é»„è‰²çš„å°ç¯ã€‚å°è¯•ä¸€ä»¶ä½ å¾ˆä¹…æ²¡ç©¿è¿‡çš„é£æ ¼ï¼Œåˆ©ç”¨è§†è§‰å·®æ¥é‡æ–°æ¿€æ´»ä»–çš„å¤šå·´èƒºã€‚</div></div>';
        }
        
        if(brakeLevel === "High") {
            actionHtml += '<div class="action-item"><span class="action-tag">ç¯å¢ƒé‡å¡‘</span><div class="action-desc">ä½ çš„å…³é”®æ˜¯â€œå®‰å…¨æ„Ÿâ€ã€‚äº²çƒ­å‰ï¼Œè¯·å½“ç€ä½ çš„é¢é”å¥½é—¨ï¼ŒæŠŠæ‰‹æœºæ‰”åˆ°å®¢å…ã€‚åˆ›é€ ä¸€ä¸ªâ€œç»å¯¹ä¸ä¼šè¢«æ‰“æ‰°â€çš„çœŸç©ºç¯å¢ƒï¼Œè¿™å¯¹ä½ çš„å¤§è„‘è‡³å…³é‡è¦ã€‚</div></div>';
        } else {
            actionHtml += '<div class="action-item"><span class="action-tag">æ·±åº¦åŒæ­¥</span><div class="action-desc">æ‰¾ä¸ªæ—¶é—´ï¼Œæ¡ç€ä»–çš„æ‰‹è¯´ï¼šâ€œæˆ‘æœ€è¿‘æ„Ÿè§‰æˆ‘ä»¬åƒå®¤å‹ï¼Œæˆ‘å¾ˆæ€€å¿µä»¥å‰ã€‚æˆ‘ä»¬å¯ä»¥ä»Šæ™šåªæ¥å»å—ï¼Ÿâ€</div></div>';
        }
        document.getElementById('action-plan').innerHTML = actionHtml;
    }
</script>
</body>
</html>
